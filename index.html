<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Rayner Foundation Application Form 2026</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <style>
    body { margin: 0; padding: 0; background: #f9fafb; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState } = React;
    
    const Mail = (props) => (
      <svg {...props} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
        <polyline points="22,6 12,13 2,6"/>
      </svg>
    );
    
    const Download = (props) => (
      <svg {...props} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3"/>
      </svg>
    );

    function RaynerFoundationForm() {
      const [formData, setFormData] = useState({
        name: '', dob: '', pob: '', address: '', homeTelephone: '', mobile: '', email: '',
        currentTeam: '', bcMembership: '', uciNumber: '', bcRanking: '', worldRanking: '',
        coachName: '', coachContact: '', agentName: '', agentContact: '', nationalInsurance: '',
        passportNo: '', passportExpiry: '', secondNationality: '', euArrangements: '',
        recentResults: Array(10).fill(null).map(() => ({ date: '', competition: '', category: '', placing: '' })),
        careerResults: Array(3).fill(null).map(() => ({ date: '', competition: '', status: '', placing: '' })),
        teamName: '', teamContact: '', teamPhone: '', teamLocation: '', teamEmail: '', teamCategory: '', ninetyDayRule: '',
        accommodationProvided: '', accommodationProvidedInfo: '', accommodationCharged: '', accommodationChargedInfo: '',
        accommodationUpkeep: '', accommodationUpkeepInfo: '', dailyFood: '', dailyFoodInfo: '',
        travelArrangement: '', travelArrangementInfo: '', equipment: '', equipmentInfo: '',
        wageSalary: '', wageSalaryInfo: '', repayment: '', repaymentInfo: '',
        otherSupport: '', otherSupportInfo: '', personalStatement: ''
      });

      const [currentSection, setCurrentSection] = useState(0);
      const [isGenerating, setIsGenerating] = useState(false);

      const updateField = (field, value) => {
        setFormData(prev => ({ ...prev, [field]: value }));
      };

      const updateArrayField = (arrayName, index, field, value) => {
        setFormData(prev => ({
          ...prev,
          [arrayName]: prev[arrayName].map((item, i) => 
            i === index ? { ...item, [field]: value } : item
          )
        }));
      };

      const generatePDFContent = () => {
        return `
          <div style="padding: 15px; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif; font-size: 10px; color: #374151;">
            <!-- Header -->
            <div style="text-align: center; background-color: #1e3a8a; color: white; padding: 20px; margin-bottom: 20px; border-radius: 8px;">
              <h1 style="font-size: 24px; font-weight: bold; margin: 0;">THE RAYNER FOUNDATION</h1>
              <h2 style="font-size: 16px; margin: 8px 0 0 0;">RIDER APPLICATION FORM 2026</h2>
            </div>
            
            <!-- SECTION 1: PERSONAL INFORMATION -->
            <div style="margin-bottom: 20px; page-break-inside: avoid;">
              <h3 style="color: #1e3a8a; font-size: 16px; font-weight: bold; margin-bottom: 15px;">PERSONAL INFORMATION</h3>
              
              <!-- Row 1: Name, DOB, POB -->
              <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-bottom: 12px;">
                <div>
                  <div style="font-size: 9px; font-weight: 600; color: #374151; margin-bottom: 4px;">Name *</div>
                  <div style="padding: 8px; border: 1px solid #d1d5db; border-radius: 4px; background: #f9fafb; min-height: 20px;">${formData.name || ''}</div>
                </div>
                <div>
                  <div style="font-size: 9px; font-weight: 600; color: #374151; margin-bottom: 4px;">Date of Birth *</div>
                  <div style="padding: 8px; border: 1px solid #d1d5db; border-radius: 4px; background: #f9fafb; min-height: 20px;">${formData.dob || ''}</div>
                </div>
                <div>
                  <div style="font-size: 9px; font-weight: 600; color: #374151; margin-bottom: 4px;">Place of Birth</div>
                  <div style="padding: 8px; border: 1px solid #d1d5db; border-radius: 4px; background: #f9fafb; min-height: 20px;">${formData.pob || ''}</div>
                </div>
              </div>

              <!-- Address -->
              <div style="margin-bottom: 12px;">
                <div style="font-size: 9px; font-weight: 600; color: #374151; margin-bottom: 4px;">Address *</div>
                <div style="padding: 8px; border: 1px solid #d1d5db; border-radius: 4px; background: #f9fafb; min-height: 40px; white-space: pre-wrap;">${formData.address || ''}</div>
              </div>

              <!-- Row 2: Phones and Email -->
              <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-bottom: 12px;">
                <div>
                  <div style="font-size: 9px; font-weight: 600; color: #374151; margin-bottom: 4px;">Home Telephone</div>
                  <div style="padding: 8px; border: 1px solid #d1d5db; border-radius: 4px; background: #f9fafb; min-height: 20px;">${formData.homeTelephone || ''}</div>
                </div>
                <div>
                  <div style="font-size: 9px; font-weight: 600; color: #374151; margin-bottom: 4px;">Mobile *</div>
                  <div style="padding: 8px; border: 1px solid #d1d5db; border-radius: 4px; background: #f9fafb; min-height: 20px;">${formData.mobile || ''}</div>
                </div>
                <div>
                  <div style="font-size: 9px; font-weight: 600; color: #374151; margin-bottom: 4px;">Email *</div>
                  <div style="padding: 8px; border: 1px solid #d1d5db; border-radius: 4px; background: #f9fafb; min-height: 20px;">${formData.email || ''}</div>
                </div>
              </div>

              <!-- Row 3: Team and BC -->
              <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 12px;">
                <div>
                  <div style="font-size: 9px; font-weight: 600; color: #374151; margin-bottom: 4px;">Current Team</div>
                  <div style="padding: 8px; border: 1px solid #d1d5db; border-radius: 4px; background: #f9fafb; min-height: 20px;">${formData.currentTeam || ''}</div>
                </div>
                <div>
                  <div style="font-size: 9px; font-weight: 600; color: #374151; margin-bottom: 4px;">BC Membership No</div>
                  <div style="padding: 8px; border: 1px solid #d1d5db; border-radius: 4px; background: #f9fafb; min-height: 20px;">${formData.bcMembership || ''}</div>
                </div>
              </div>

              <!-- Row 4: UCI, Rankings -->
              <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-bottom: 12px;">
                <div>
                  <div style="font-size: 9px; font-weight: 600; color: #374151; margin-bottom: 4px;">UCI Number</div>
                  <div style="padding: 8px; border: 1px solid #d1d5db; border-radius: 4px; background: #f9fafb; min-height: 20px;">${formData.uciNumber || ''}</div>
                </div>
                <div>
                  <div style="font-size: 9px; font-weight: 600; color: #374151; margin-bottom: 4px;">BC Ranking Category</div>
                  <div style="padding: 8px; border: 1px solid #d1d5db; border-radius: 4px; background: #f9fafb; min-height: 20px;">${formData.bcRanking || ''}</div>
                </div>
                <div>
                  <div style="font-size: 9px; font-weight: 600; color: #374151; margin-bottom: 4px;">World Ranking</div>
                  <div style="padding: 8px; border: 1px solid #d1d5db; border-radius: 4px; background: #f9fafb; min-height: 20px;">${formData.worldRanking || ''}</div>
                </div>
              </div>

              <!-- Row 5: Coach -->
              <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 12px;">
                <div>
                  <div style="font-size: 9px; font-weight: 600; color: #374151; margin-bottom: 4px;">Coach Name</div>
                  <div style="padding: 8px; border: 1px solid #d1d5db; border-radius: 4px; background: #f9fafb; min-height: 20px;">${formData.coachName || ''}</div>
                </div>
                <div>
                  <div style="font-size: 9px; font-weight: 600; color: #374151; margin-bottom: 4px;">Coach Contact</div>
                  <div style="padding: 8px; border: 1px solid #d1d5db; border-radius: 4px; background: #f9fafb; min-height: 20px;">${formData.coachContact || ''}</div>
                </div>
              </div>

              <!-- Row 6: Agent -->
              <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 12px;">
                <div>
                  <div style="font-size: 9px; font-weight: 600; color: #374151; margin-bottom: 4px;">Agent Name</div>
                  <div style="padding: 8px; border: 1px solid #d1d5db; border-radius: 4px; background: #f9fafb; min-height: 20px;">${formData.agentName || ''}</div>
                </div>
                <div>
                  <div style="font-size: 9px; font-weight: 600; color: #374151; margin-bottom: 4px;">Agent Contact</div>
                  <div style="padding: 8px; border: 1px solid #d1d5db; border-radius: 4px; background: #f9fafb; min-height: 20px;">${formData.agentContact || ''}</div>
                </div>
              </div>

              <!-- Row 7: NI, Passport -->
              <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-bottom: 12px;">
                <div>
                  <div style="font-size: 9px; font-weight: 600; color: #374151; margin-bottom: 4px;">National Insurance No</div>
                  <div style="padding: 8px; border: 1px solid #d1d5db; border-radius: 4px; background: #f9fafb; min-height: 20px;">${formData.nationalInsurance || ''}</div>
                </div>
                <div>
                  <div style="font-size: 9px; font-weight: 600; color: #374151; margin-bottom: 4px;">Passport No</div>
                  <div style="padding: 8px; border: 1px solid #d1d5db; border-radius: 4px; background: #f9fafb; min-height: 20px;">${formData.passportNo || ''}</div>
                </div>
                <div>
                  <div style="font-size: 9px; font-weight: 600; color: #374151; margin-bottom: 4px;">Passport Expiry</div>
                  <div style="padding: 8px; border: 1px solid #d1d5db; border-radius: 4px; background: #f9fafb; min-height: 20px;">${formData.passportExpiry || ''}</div>
                </div>
              </div>

              <!-- Second Nationality -->
              <div style="margin-bottom: 12px;">
                <div style="font-size: 9px; font-weight: 600; color: #374151; margin-bottom: 4px;">Second Nationality?</div>
                <div style="padding: 8px; border: 1px solid #d1d5db; border-radius: 4px; background: #f9fafb; min-height: 20px;">${formData.secondNationality || ''}</div>
              </div>

              <!-- EU Arrangements -->
              <div style="margin-bottom: 12px;">
                <div style="font-size: 9px; font-weight: 600; color: #374151; margin-bottom: 4px;">EU Arrangements</div>
                <div style="padding: 8px; border: 1px solid #d1d5db; border-radius: 4px; background: #f9fafb; min-height: 30px; white-space: pre-wrap;">${formData.euArrangements || ''}</div>
              </div>
            </div>

            <!-- SECTION 2: RACING ACHIEVEMENTS -->
            <div style="margin-bottom: 20px; page-break-inside: avoid;">
              <h3 style="color: #1e3a8a; font-size: 16px; font-weight: bold; margin-bottom: 10px;">RACING ACHIEVEMENTS - Last 12 Months</h3>
              <p style="font-size: 9px; color: #6b7280; margin-bottom: 10px;">Best 10 results in order of success</p>
              
              <table style="width: 100%; border-collapse: collapse; border: 1px solid #d1d5db; margin-bottom: 15px;">
                <thead>
                  <tr style="background-color: #f3f4f6;">
                    <th style="border: 1px solid #d1d5db; padding: 6px; text-align: left; font-size: 9px; font-weight: 600;">Date</th>
                    <th style="border: 1px solid #d1d5db; padding: 6px; text-align: left; font-size: 9px; font-weight: 600;">Competition</th>
                    <th style="border: 1px solid #d1d5db; padding: 6px; text-align: left; font-size: 9px; font-weight: 600;">Category</th>
                    <th style="border: 1px solid #d1d5db; padding: 6px; text-align: left; font-size: 9px; font-weight: 600;">Placing</th>
                  </tr>
                </thead>
                <tbody>
                  ${formData.recentResults.map(r => `
                    <tr>
                      <td style="border: 1px solid #d1d5db; padding: 6px; font-size: 9px; background: #f9fafb;">${r.date || ''}</td>
                      <td style="border: 1px solid #d1d5db; padding: 6px; font-size: 9px; background: #f9fafb;">${r.competition || ''}</td>
                      <td style="border: 1px solid #d1d5db; padding: 6px; font-size: 9px; background: #f9fafb;">${r.category || ''}</td>
                      <td style="border: 1px solid #d1d5db; padding: 6px; font-size: 9px; background: #f9fafb;">${r.placing || ''}</td>
                    </tr>
                  `).join('')}
                </tbody>
              </table>

              <h3 style="color: #1e3a8a; font-size: 16px; font-weight: bold; margin-bottom: 10px; margin-top: 20px;">BEST 3 CAREER ACHIEVEMENTS</h3>
              
              <table style="width: 100%; border-collapse: collapse; border: 1px solid #d1d5db;">
                <thead>
                  <tr style="background-color: #f3f4f6;">
                    <th style="border: 1px solid #d1d5db; padding: 6px; text-align: left; font-size: 9px; font-weight: 600;">Date</th>
                    <th style="border: 1px solid #d1d5db; padding: 6px; text-align: left; font-size: 9px; font-weight: 600;">Competition</th>
                    <th style="border: 1px solid #d1d5db; padding: 6px; text-align: left; font-size: 9px; font-weight: 600;">Status</th>
                    <th style="border: 1px solid #d1d5db; padding: 6px; text-align: left; font-size: 9px; font-weight: 600;">Placing</th>
                  </tr>
                </thead>
                <tbody>
                  ${formData.careerResults.map(r => `
                    <tr>
                      <td style="border: 1px solid #d1d5db; padding: 6px; font-size: 9px; background: #f9fafb;">${r.date || ''}</td>
                      <td style="border: 1px solid #d1d5db; padding: 6px; font-size: 9px; background: #f9fafb;">${r.competition || ''}</td>
                      <td style="border: 1px solid #d1d5db; padding: 6px; font-size: 9px; background: #f9fafb;">${r.status || ''}</td>
                      <td style="border: 1px solid #d1d5db; padding: 6px; font-size: 9px; background: #f9fafb;">${r.placing || ''}</td>
                    </tr>
                  `).join('')}
                </tbody>
              </table>
            </div>

            <!-- SECTION 3: PLACEMENT INFORMATION -->
            <div style="margin-bottom: 20px; page-break-inside: avoid;">
              <h3 style="color: #1e3a8a; font-size: 16px; font-weight: bold; margin-bottom: 15px;">PLACEMENT INFORMATION</h3>
              
              <!-- Team Name and Contact -->
              <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 12px;">
                <div>
                  <div style="font-size: 9px; font-weight: 600; color: #374151; margin-bottom: 4px;">Team Name</div>
                  <div style="padding: 8px; border: 1px solid #d1d5db; border-radius: 4px; background: #f9fafb; min-height: 20px;">${formData.teamName || ''}</div>
                </div>
                <div>
                  <div style="font-size: 9px; font-weight: 600; color: #374151; margin-bottom: 4px;">Team Contact</div>
                  <div style="padding: 8px; border: 1px solid #d1d5db; border-radius: 4px; background: #f9fafb; min-height: 20px;">${formData.teamContact || ''}</div>
                </div>
              </div>

              <!-- Team Location -->
              <div style="margin-bottom: 12px;">
                <div style="font-size: 9px; font-weight: 600; color: #374151; margin-bottom: 4px;">Team Location</div>
                <div style="padding: 8px; border: 1px solid #d1d5db; border-radius: 4px; background: #f9fafb; min-height: 30px; white-space: pre-wrap;">${formData.teamLocation || ''}</div>
              </div>

              <!-- Team Details -->
              <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-bottom: 12px;">
                <div>
                  <div style="font-size: 9px; font-weight: 600; color: #374151; margin-bottom: 4px;">Team Phone</div>
                  <div style="padding: 8px; border: 1px solid #d1d5db; border-radius: 4px; background: #f9fafb; min-height: 20px;">${formData.teamPhone || ''}</div>
                </div>
                <div>
                  <div style="font-size: 9px; font-weight: 600; color: #374151; margin-bottom: 4px;">Team Email</div>
                  <div style="padding: 8px; border: 1px solid #d1d5db; border-radius: 4px; background: #f9fafb; min-height: 20px;">${formData.teamEmail || ''}</div>
                </div>
                <div>
                  <div style="font-size: 9px; font-weight: 600; color: #374151; margin-bottom: 4px;">Team Category</div>
                  <div style="padding: 8px; border: 1px solid #d1d5db; border-radius: 4px; background: #f9fafb; min-height: 20px;">${formData.teamCategory || ''}</div>
                </div>
              </div>

              <!-- 90 Day Rule -->
              <div style="margin-bottom: 12px;">
                <div style="font-size: 9px; font-weight: 600; color: #374151; margin-bottom: 4px;">If you are restricted by the 90 day rule and are not available for the whole season, please provide written agreement from your team.</div>
                <div style="padding: 8px; border: 1px solid #d1d5db; border-radius: 4px; background: #f9fafb; min-height: 30px; white-space: pre-wrap;">${formData.ninetyDayRule || ''}</div>
              </div>

              <h3 style="color: #1e3a8a; font-size: 16px; font-weight: bold; margin-bottom: 10px; margin-top: 20px;">FUNDING INFORMATION</h3>
              <p style="font-size: 9px; color: #6b7280; margin-bottom: 15px;">Answer these questions completely and truthfully</p>

              ${[
                ['accommodationProvided', 'accommodationProvidedInfo', 'Is your accommodation provided?'],
                ['accommodationCharged', 'accommodationChargedInfo', 'Is your accommodation charged? How much?'],
                ['accommodationUpkeep', 'accommodationUpkeepInfo', 'Do you contribute to accommodation upkeep?'],
                ['dailyFood', 'dailyFoodInfo', 'Do you pay for daily food? How much?'],
                ['travelArrangement', 'travelArrangementInfo', 'Will you have to pay to travel to races? Please provide details'],
                ['equipment', 'equipmentInfo', 'Do you receive equipment from team?'],
                ['wageSalary', 'wageSalaryInfo', 'Do you receive a wage/salary? How much per annum?'],
                ['repayment', 'repaymentInfo', 'Will you be expected to repay any support costs?'],
                ['otherSupport', 'otherSupportInfo', 'Do you have any other income or support sources? Please give details below']
              ].map(([field, infoField, label]) => `
                <div style="margin-bottom: 12px;">
                  <div style="font-size: 9px; font-weight: 600; color: #374151; margin-bottom: 6px;">${label}</div>
                  <div style="display: grid; grid-template-columns: 80px 1fr; gap: 8px;">
                    <div>
                      <div style="font-size: 8px; color: #6b7280; margin-bottom: 2px;">Y/N</div>
                      <div style="padding: 6px; border: 1px solid #d1d5db; border-radius: 4px; background: #f9fafb; font-size: 9px;">${formData[field] || ''}</div>
                    </div>
                    <div>
                      <div style="font-size: 8px; color: #6b7280; margin-bottom: 2px;">Further Information</div>
                      <div style="padding: 6px; border: 1px solid #d1d5db; border-radius: 4px; background: #f9fafb; min-height: 24px; font-size: 9px; white-space: pre-wrap;">${formData[infoField] || ''}</div>
                    </div>
                  </div>
                </div>
              `).join('')}
            </div>

            <!-- SECTION 4: IN YOUR OWN WORDS -->
            <div style="margin-bottom: 20px; page-break-inside: avoid;">
              <h3 style="color: #1e3a8a; font-size: 16px; font-weight: bold; margin-bottom: 10px;">IN YOUR OWN WORDS</h3>
              <div style="font-size: 9px; color: #374151; margin-bottom: 8px;">Tell us why you would like to become a Rayner Foundation Rider. How you think the RF could help you at the beginning of your career and just as importantly, how you think you could help the RF from now and throughout your career.</div>
              <div style="padding: 12px; border: 1px solid #d1d5db; border-radius: 4px; background: #f9fafb; min-height: 120px; font-size: 10px; line-height: 1.6; white-space: pre-wrap;">${formData.personalStatement || ''}</div>
              
              <div style="margin-top: 20px; padding: 12px; background: #eff6ff; border-left: 4px solid #3b82f6; border-radius: 4px;">
                <p style="font-size: 9px; color: #1e40af; margin: 0;"><strong>Submission Instructions:</strong> Once completed, you can email this form to: <span style="font-family: monospace;">nigelbishop@live.co.uk</span></p>
              </div>
            </div>
          </div>
        `;
      };

      const handleDownloadPDF = async () => {
        setIsGenerating(true);
        
        const element = document.createElement('div');
        element.innerHTML = generatePDFContent();

        const opt = {
          margin: [10, 10, 10, 10],
          filename: `Rayner_Application_${formData.name.replace(/\s+/g, '_') || 'Form'}_2026.pdf`,
          image: { type: 'jpeg', quality: 0.98 },
          html2canvas: { scale: 2, logging: false, useCORS: true },
          jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' },
          pagebreak: { mode: ['css', 'legacy'] }
        };

        try {
          await // html2pdf removed (replaced by buildFillablePDF)
        } catch (error) {
          console.error('PDF Error:', error);
          alert('Error generating PDF. Please try again.');
        } finally {
          setIsGenerating(false);
        }
      };

      const handleEmailWithPDF = async () => {
        setIsGenerating(true);
        
        // First generate and download the PDF
        const element = document.createElement('div');
        element.innerHTML = generatePDFContent();

        const filename = `Rayner_Application_${formData.name.replace(/\s+/g, '_') || 'Form'}_2026.pdf`;
        
        const opt = {
          margin: [2, 8, 8, 8],
          filename: filename,
          image: { type: 'jpeg', quality: 0.98 },
          html2canvas: { scale: 2, logging: false, useCORS: true },
          jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' },
          pagebreak: { mode: ['avoid-all', 'css', 'legacy'] }
        };

        try {
          await // html2pdf removed (replaced by buildFillablePDF)
          
          // Wait a moment for download to start, then open email
          setTimeout(() => {
            const subject = encodeURIComponent('Rayner Foundation Rider Application 2026 - ' + formData.name);
            const body = encodeURIComponent(`Dear Rayner Foundation,

Please find attached my completed application form for the Rayner Foundation Rider Programme 2026.

The PDF file "${filename}" should be in your Downloads folder. Please attach it to this email before sending.

Applicant Name: ${formData.name}
Email: ${formData.email}
Mobile: ${formData.mobile}

Best regards,
${formData.name}`);
            
            window.location.href = `mailto:applications@rayner.fund;joscelinryan@hotmail.com?subject=${subject}&body=${body}`;
            setIsGenerating(false);
          }, 1000);
        } catch (error) {
          console.error('PDF Error:', error);
          alert('Error generating PDF. Please try again.');
          setIsGenerating(false);
        }
      };

      const sections = [
        { name: 'Personal Information', id: 0 },
        { name: 'Racing Achievements', id: 1 },
        { name: 'Placement Information', id: 2 },
        { name: 'In Your Own Words', id: 3 }
      ];

      const fundingQuestions = [
        ['accommodationProvided', 'accommodationProvidedInfo', 'Is your accommodation provided?'],
        ['accommodationCharged', 'accommodationChargedInfo', 'Is your accommodation charged? How much?'],
        ['accommodationUpkeep', 'accommodationUpkeepInfo', 'Do you contribute to accommodation upkeep?'],
        ['dailyFood', 'dailyFoodInfo', 'Do you pay for daily food? How much?'],
        ['travelArrangement', 'travelArrangementInfo', 'Will you have to pay to travel to races? Please provide details'],
        ['equipment', 'equipmentInfo', 'Do you receive equipment from team?'],
        ['wageSalary', 'wageSalaryInfo', 'Do you receive a wage/salary? How much per annum?'],
        ['repayment', 'repaymentInfo', 'Will you be expected to repay any support costs?'],
        ['otherSupport', 'otherSupportInfo', 'Do you have any other income or support sources? Please give details below']
      ];

      return (
        <div className="min-h-screen bg-gray-50 p-4">
          <div className="max-w-5xl mx-auto bg-white shadow-lg rounded-lg overflow-hidden">
            <div className="bg-blue-900 text-white p-6 text-center">
              <h1 className="text-3xl font-bold">THE RAYNER FOUNDATION</h1>
              <h2 className="text-xl mt-2">RIDER APPLICATION FORM 2026</h2>
            </div>

            <div className="border-b border-gray-200 bg-gray-50">
              <nav className="flex space-x-2 p-4 overflow-x-auto">
                {sections.map((section) => (
                  <button
                    key={section.id}
                    onClick={() => setCurrentSection(section.id)}
                    className={`px-4 py-2 rounded-t-lg font-medium transition-colors whitespace-nowrap ${
                      currentSection === section.id
                        ? 'bg-white text-blue-900 border-t-2 border-blue-900'
                        : 'bg-gray-200 text-gray-600 hover:bg-gray-300'
                    }`}
                  >
                    {section.name}
                  </button>
                ))}
              </nav>
            </div>

            <div className="p-6">
              {/* FORM SECTIONS - keeping all existing sections exactly as they were */}
              {currentSection === 0 && (
                <div className="space-y-6">
                  <h3 className="text-2xl font-bold text-blue-900 mb-4">PERSONAL INFORMATION</h3>
                  
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div className="md:col-span-1">
                      <label className="block text-sm font-medium text-gray-700 mb-1">Name *</label>
                      <input type="text" value={formData.name} onChange={(e) => updateField('name', e.target.value)} className="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500" />
                    </div>
                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-1">Date of Birth *</label>
                      <input type="date" value={formData.dob} onChange={(e) => updateField('dob', e.target.value)} className="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500" />
                    </div>
                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-1">Place of Birth</label>
                      <input type="text" value={formData.pob} onChange={(e) => updateField('pob', e.target.value)} className="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500" />
                    </div>
                  </div>
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-1">Address *</label>
                    <textarea value={formData.address} onChange={(e) => updateField('address', e.target.value)} rows="3" className="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500" />
                  </div>
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-1">Home Telephone</label>
                      <input type="tel" value={formData.homeTelephone} onChange={(e) => updateField('homeTelephone', e.target.value)} className="w-full px-3 py-2 border border-gray-300 rounded-md" />
                    </div>
                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-1">Mobile *</label>
                      <input type="tel" value={formData.mobile} onChange={(e) => updateField('mobile', e.target.value)} className="w-full px-3 py-2 border border-gray-300 rounded-md" />
                    </div>
                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-1">Email *</label>
                      <input type="email" value={formData.email} onChange={(e) => updateField('email', e.target.value)} className="w-full px-3 py-2 border border-gray-300 rounded-md" />
                    </div>
                  </div>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-1">Current Team</label>
                      <input type="text" value={formData.currentTeam} onChange={(e) => updateField('currentTeam', e.target.value)} className="w-full px-3 py-2 border border-gray-300 rounded-md" />
                    </div>
                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-1">BC Membership No</label>
                      <input type="text" value={formData.bcMembership} onChange={(e) => updateField('bcMembership', e.target.value)} className="w-full px-3 py-2 border border-gray-300 rounded-md" />
                    </div>
                  </div>
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-1">UCI Number</label>
                      <input type="text" value={formData.uciNumber} onChange={(e) => updateField('uciNumber', e.target.value)} className="w-full px-3 py-2 border border-gray-300 rounded-md" />
                    </div>
                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-1">BC Ranking Category</label>
                      <input type="text" value={formData.bcRanking} onChange={(e) => updateField('bcRanking', e.target.value)} className="w-full px-3 py-2 border border-gray-300 rounded-md" />
                    </div>
                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-1">World Ranking</label>
                      <input type="text" value={formData.worldRanking} onChange={(e) => updateField('worldRanking', e.target.value)} className="w-full px-3 py-2 border border-gray-300 rounded-md" />
                    </div>
                  </div>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-1">Coach Name</label>
                      <input type="text" value={formData.coachName} onChange={(e) => updateField('coachName', e.target.value)} className="w-full px-3 py-2 border border-gray-300 rounded-md" />
                    </div>
                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-1">Coach Contact</label>
                      <input type="text" value={formData.coachContact} onChange={(e) => updateField('coachContact', e.target.value)} className="w-full px-3 py-2 border border-gray-300 rounded-md" />
                    </div>
                  </div>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-1">Agent Name</label>
                      <input type="text" value={formData.agentName} onChange={(e) => updateField('agentName', e.target.value)} className="w-full px-3 py-2 border border-gray-300 rounded-md" />
                    </div>
                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-1">Agent Contact</label>
                      <input type="text" value={formData.agentContact} onChange={(e) => updateField('agentContact', e.target.value)} className="w-full px-3 py-2 border border-gray-300 rounded-md" />
                    </div>
                  </div>
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-1">National Insurance No</label>
                      <input type="text" value={formData.nationalInsurance} onChange={(e) => updateField('nationalInsurance', e.target.value)} className="w-full px-3 py-2 border border-gray-300 rounded-md" />
                    </div>
                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-1">Passport No</label>
                      <input type="text" value={formData.passportNo} onChange={(e) => updateField('passportNo', e.target.value)} className="w-full px-3 py-2 border border-gray-300 rounded-md" />
                    </div>
                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-1">Passport Expiry</label>
                      <input type="date" value={formData.passportExpiry} onChange={(e) => updateField('passportExpiry', e.target.value)} className="w-full px-3 py-2 border border-gray-300 rounded-md" />
                    </div>
                  </div>
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-1">Second Nationality?</label>
                    <input type="text" value={formData.secondNationality} onChange={(e) => updateField('secondNationality', e.target.value)} className="w-full px-3 py-2 border border-gray-300 rounded-md" />
                  </div>
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-1">EU Arrangements</label>
                    <textarea value={formData.euArrangements} onChange={(e) => updateField('euArrangements', e.target.value)} rows="2" className="w-full px-3 py-2 border border-gray-300 rounded-md" />
                  </div>
                </div>
              )}

              {currentSection === 1 && (
                <div className="space-y-6">
                  <h3 className="text-2xl font-bold text-blue-900 mb-4">RACING ACHIEVEMENTS - Last 12 Months</h3>
                  <p className="text-sm text-gray-600 mb-4">Best 10 results in order of success</p>
                  <div className="overflow-x-auto">
                    <table className="w-full border-collapse border border-gray-300">
                      <thead>
                        <tr className="bg-gray-100">
                          <th className="border border-gray-300 px-4 py-2 text-left">Date</th>
                          <th className="border border-gray-300 px-4 py-2 text-left">Competition</th>
                          <th className="border border-gray-300 px-4 py-2 text-left">Category</th>
                          <th className="border border-gray-300 px-4 py-2 text-left">Placing</th>
                        </tr>
                      </thead>
                      <tbody>
                        {formData.recentResults.map((result, index) => (
                          <tr key={index}>
                            <td className="border border-gray-300 p-2">
                              <input type="date" value={result.date} onChange={(e) => updateArrayField('recentResults', index, 'date', e.target.value)} className="w-full px-2 py-1 border-0 focus:ring-1 focus:ring-blue-500" />
                            </td>
                            <td className="border border-gray-300 p-2">
                              <input type="text" value={result.competition} onChange={(e) => updateArrayField('recentResults', index, 'competition', e.target.value)} className="w-full px-2 py-1 border-0 focus:ring-1 focus:ring-blue-500" />
                            </td>
                            <td className="border border-gray-300 p-2">
                              <input type="text" value={result.category} onChange={(e) => updateArrayField('recentResults', index, 'category', e.target.value)} className="w-full px-2 py-1 border-0 focus:ring-1 focus:ring-blue-500" />
                            </td>
                            <td className="border border-gray-300 p-2">
                              <input type="text" value={result.placing} onChange={(e) => updateArrayField('recentResults', index, 'placing', e.target.value)} className="w-full px-2 py-1 border-0 focus:ring-1 focus:ring-blue-500" />
                            </td>
                          </tr>
                        ))}
                      </tbody>
                    </table>
                  </div>
                  <h3 className="text-2xl font-bold text-blue-900 mb-4 mt-8">BEST 3 CAREER ACHIEVEMENTS</h3>
                  <div className="overflow-x-auto">
                    <table className="w-full border-collapse border border-gray-300">
                      <thead>
                        <tr className="bg-gray-100">
                          <th className="border border-gray-300 px-4 py-2 text-left">Date</th>
                          <th className="border border-gray-300 px-4 py-2 text-left">Competition</th>
                          <th className="border border-gray-300 px-4 py-2 text-left">Status</th>
                          <th className="border border-gray-300 px-4 py-2 text-left">Placing</th>
                        </tr>
                      </thead>
                      <tbody>
                        {formData.careerResults.map((result, index) => (
                          <tr key={index}>
                            <td className="border border-gray-300 p-2">
                              <input type="date" value={result.date} onChange={(e) => updateArrayField('careerResults', index, 'date', e.target.value)} className="w-full px-2 py-1 border-0 focus:ring-1 focus:ring-blue-500" />
                            </td>
                            <td className="border border-gray-300 p-2">
                              <input type="text" value={result.competition} onChange={(e) => updateArrayField('careerResults', index, 'competition', e.target.value)} className="w-full px-2 py-1 border-0 focus:ring-1 focus:ring-blue-500" />
                            </td>
                            <td className="border border-gray-300 p-2">
                              <input type="text" value={result.status} onChange={(e) => updateArrayField('careerResults', index, 'status', e.target.value)} className="w-full px-2 py-1 border-0 focus:ring-1 focus:ring-blue-500" />
                            </td>
                            <td className="border border-gray-300 p-2">
                              <input type="text" value={result.placing} onChange={(e) => updateArrayField('careerResults', index, 'placing', e.target.value)} className="w-full px-2 py-1 border-0 focus:ring-1 focus:ring-blue-500" />
                            </td>
                          </tr>
                        ))}
                      </tbody>
                    </table>
                  </div>
                </div>
              )}

              {currentSection === 2 && (
                <div className="space-y-6">
                  <h3 className="text-2xl font-bold text-blue-900 mb-4">PLACEMENT INFORMATION</h3>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-1">Team Name</label>
                      <input type="text" value={formData.teamName} onChange={(e) => updateField('teamName', e.target.value)} className="w-full px-3 py-2 border border-gray-300 rounded-md" />
                    </div>
                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-1">Team Contact</label>
                      <input type="text" value={formData.teamContact} onChange={(e) => updateField('teamContact', e.target.value)} className="w-full px-3 py-2 border border-gray-300 rounded-md" />
                    </div>
                  </div>
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-1">Team Location</label>
                    <textarea value={formData.teamLocation} onChange={(e) => updateField('teamLocation', e.target.value)} rows="2" className="w-full px-3 py-2 border border-gray-300 rounded-md" />
                  </div>
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-1">Team Phone</label>
                      <input type="tel" value={formData.teamPhone} onChange={(e) => updateField('teamPhone', e.target.value)} className="w-full px-3 py-2 border border-gray-300 rounded-md" />
                    </div>
                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-1">Team Email</label>
                      <input type="email" value={formData.teamEmail} onChange={(e) => updateField('teamEmail', e.target.value)} className="w-full px-3 py-2 border border-gray-300 rounded-md" />
                    </div>
                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-1">Team Category</label>
                      <input type="text" value={formData.teamCategory} onChange={(e) => updateField('teamCategory', e.target.value)} className="w-full px-3 py-2 border border-gray-300 rounded-md" />
                    </div>
                  </div>
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-1">If you are restricted by the 90 day rule and are not available for the whole season, please provide written agreement from your team.</label>
                    <textarea value={formData.ninetyDayRule} onChange={(e) => updateField('ninetyDayRule', e.target.value)} rows="2" className="w-full px-3 py-2 border border-gray-300 rounded-md" />
                  </div>
                  <h3 className="text-2xl font-bold text-blue-900 mb-4 mt-8">FUNDING INFORMATION</h3>
                  <p className="text-sm text-gray-600 mb-4">Answer these questions completely and truthfully</p>
                  {fundingQuestions.map(([field, infoField, label]) => (
                    <div key={field} className="space-y-2">
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div className="md:col-span-2">
                          <label className="block text-sm font-medium text-gray-700 mb-1">{label}</label>
                        </div>
                        <div>
                          <label className="block text-sm font-medium text-gray-700 mb-1">Y/N</label>
                          <select value={formData[field]} onChange={(e) => updateField(field, e.target.value)} className="w-full px-3 py-2 border border-gray-300 rounded-md">
                            <option value="">Select</option>
                            <option value="Yes">Yes</option>
                            <option value="No">No</option>
                          </select>
                        </div>
                      </div>
                      <div>
                        <label className="block text-sm font-medium text-gray-700 mb-1">Further Information</label>
                        <textarea value={formData[infoField]} onChange={(e) => updateField(infoField, e.target.value)} rows="2" className="w-full px-3 py-2 border border-gray-300 rounded-md" />
                      </div>
                    </div>
                  ))}
                </div>
              )}

              {currentSection === 3 && (
                <div className="space-y-6">
                  <h3 className="text-2xl font-bold text-blue-900 mb-4">IN YOUR OWN WORDS</h3>
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">
                      Tell us why you would like to become a Rayner Foundation Rider. How you think the RF could help you at the beginning of your career and just as importantly, how you think you could help the RF from now and throughout your career.
                    </label>
                    <textarea value={formData.personalStatement} onChange={(e) => updateField('personalStatement', e.target.value)} rows="15" className="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500" placeholder="Please write your personal statement here..." />
                  </div>
                  <div className="bg-blue-50 border-l-4 border-blue-500 p-4">
                    <p className="text-sm text-gray-700">
                      <strong>Submission Instructions:</strong> Once completed, you can email this form to:<br />
                      <span className="font-mono text-blue-700">applications@rayner.fund AND joscelinryan@hotmail.com</span>
                    </p>
                  </div>
                </div>
              )}
            </div>

            <div className="border-t border-gray-200 bg-gray-50 p-6">
              <div className="flex flex-wrap gap-3 justify-between items-center">
                <div className="flex gap-3">
                  {currentSection > 0 && (
                    <button onClick={() => setCurrentSection(currentSection - 1)} className="px-6 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 transition-colors font-medium">
                      Previous
                    </button>
                  )}
                  {currentSection < 3 && (
                    <button onClick={() => setCurrentSection(currentSection + 1)} className="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium">
                      Next
                    </button>
                  )}
                </div>
                
                <div className="flex gap-3">
                  <button onClick={handleDownloadPDF} disabled={isGenerating} className="flex items-center gap-2 px-6 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors font-medium disabled:opacity-50">
                    <Download size={18} />
                    {isGenerating ? 'Generating...' : 'Download PDF'}
                  </button>
                  <button onClick={handleEmailWithPDF} disabled={isGenerating} className="flex items-center gap-2 px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors font-medium disabled:opacity-50">
                    <Mail size={18} />
                    {isGenerating ? 'Preparing Email...' : 'Email Application'}
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      );
    }

    ReactDOM.render(<RaynerFoundationForm />, document.getElementById('root'));
  </script>
<script defer src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>

<script>
// === Fillable (AcroForm) PDF generator ===
async function buildFillablePDF(formData) {
  const { PDFDocument, StandardFonts, rgb } = PDFLib;
  const A4W = 595.28, A4H = 841.89, M = 36;
  const pdf = await PDFDocument.create();
  const font = await pdf.embedFont(StandardFonts.Helvetica);
  const bold = await pdf.embedFont(StandardFonts.HelveticaBold);
  let page = pdf.addPage([A4W, A4H]);
  const form = pdf.getForm();
  let y = A4H - M;

  const heading = (t) => { y -= 18; page.drawText(t,{x:M,y,size:14,font:bold}); y -= 4;
    page.drawLine({start:{x:M,y}, end:{x:A4W-M,y}, thickness:1, color:rgb(.1,.1,.3)}); };
  const ensure = (need=60) => { if (y - need < M) { page = pdf.addPage([A4W,A4H]); y = A4H - M; } };
  const addField = (label, name, val="", { width=A4W-M*2, height=20, multiline=false }={}) => {
    ensure(40); y -= 16; page.drawText(label,{x:M,y,size:11,font:bold});
    y -= (height + 6); const fy = y;
    page.drawRectangle({x:M,y:fy,width:width,height:height,borderColor:rgb(.7,.7,.7),borderWidth:.8});
    const tf = form.createTextField(name); if (multiline) tf.enableMultiline();
    tf.setFontSize(11); tf.setTextColor(rgb(0,0,0)); tf.setBorderColor(rgb(.6,.6,.6));
    if (val) tf.setText(String(val));
    tf.addToPage(page,{x:M+2,y:fy+2,width:width-4,height:height-4});
  };
  const rowFields = (yTop, x, w, names, vals, {height=20, multiline=[]}={}) => {
    for (let i=0;i<x.length;i++) {
      page.drawRectangle({x:x[i], y:yTop-height, width:w[i], height, borderColor:rgb(.7,.7,.7), borderWidth:.8});
      const tf = form.createTextField(names[i]); if (multiline[i]) tf.enableMultiline();
      tf.setFontSize(10); tf.setTextColor(rgb(0,0,0)); tf.setBorderColor(rgb(.6,.6,.6));
      if (vals && vals[i] != null) tf.setText(String(vals[i]));
      tf.addToPage(page,{x:x[i]+2,y:yTop-height+2,width:w[i]-4,height:height-4});
    }
  };
  const table = (title, headers, rows, prefix, widths=[80,260,110,80]) => {
    ensure(80); y -= 18; page.drawText(title,{x:M,y,size:12,font:bold});
    y -= 18; const headY = y;
    const x = [M, M+widths[0], M+widths[0]+widths[1], M+widths[0]+widths[1]+widths[2]];
    for (let i=0;i<headers.length;i++) {
      page.drawRectangle({x:x[i], y:headY-18, width:widths[i], height:18, color:rgb(.93,.95,.99), borderColor:rgb(.7,.7,.9)});
      page.drawText(headers[i], {x:x[i]+4, y:headY-13, size:10, font:bold, color:rgb(.1,.1,.4)});
    }
    y = headY - 18; const rowH = 22;
    const addRow = (vals, idxLabel) => {
      ensure(rowH+6); const top = y - 4;
      const names = [
        `${prefix}.${idxLabel}.date`,
        `${prefix}.${idxLabel}.competition`,
        `${prefix}.${idxLabel}.${headers[2].toLowerCase()}`,
        `${prefix}.${idxLabel}.placing`
      ];
      rowFields(top, x, widths, names, vals, {height:22, multiline:[false,true,false,false]});
      y = top - (rowH - 2);
    };
    rows.forEach((r,i) => addRow(r,i));
    for (let e=0;e<3;e++) addRow(["","","",""], `extra${e}`);
    y -= 6;
  };

  // Header banner
  page.drawRectangle({x:0,y:A4H-54,width:A4W,height:40,color:rgb(.11,.2,.55)});
  page.drawText("THE RAYNER FOUNDATION",{x:M,y:A4H-34,size:16,font:bold,color:rgb(1,1,1)});
  page.drawText("RIDER APPLICATION FORM 2026",{x:M,y:A4H-48,size:11,font:font,color:rgb(1,1,1)});

  // Use existing data
  const f = formData || {};

  // SECTION 1
  heading("SECTION 1: PERSONAL INFORMATION");
  addField("Full name","name", (f.name||""));
  addField("Date of birth","dob", (f.dob||""), {width:200});
  addField("Nationality","nationality", (f.nationality||""), {width:300});
  addField("Address","address", (f.address||""));
  addField("Postcode","postcode", (f.postcode||""), {width:200});
  addField("Email","email", (f.email||""));
  addField("Phone","phone", (f.phone||""), {width:250});
  addField("Passport number","passportNo", (f.passportNo||""), {width:250});
  addField("Passport expiry","passportExpiry", (f.passportExpiry||""), {width:200});
  addField("EU arrangements (if applicable)","euArrangements", (f.euArrangements||""), {multiline:true, height:50});

  // SECTION 2
  heading("SECTION 2: RACING ACHIEVEMENTS");
  const byCat = (f.resultsByCategory||f.achievementsByCategory||[]).map(r=>[r?.date||"", r?.competition||"", r?.category||"", r?.placing||""]);
  table("Results (by category)", ["Date","Competition","Category","Placing"], byCat, "resultsByCategory");
  const byStatus = (f.resultsByStatus||f.achievementsByStatus||[]).map(r=>[r?.date||"", r?.competition||"", r?.status||"", r?.placing||""]);
  table("Other events (by status)", ["Date","Competition","Status","Placing"], byStatus, "resultsByStatus");

  // SECTION 3
  heading("SECTION 3: PLACEMENT INFORMATION");
  addField("Team / Club name","teamName", (f.teamName||f.team||""));
  addField("Country","teamCountry", (f.teamCountry||f.country||""), {width:250});
  addField("Start date","placementStart", (f.placementStart||f.startDate||""), {width:200});
  addField("End date","placementEnd", (f.placementEnd||f.endDate||""), {width:200});
  addField("Contact name","teamContactName", (f.teamContactName||f.contactName||""), {width:250});
  addField("Contact email","teamContactEmail", (f.teamContactEmail||f.contactEmail||""), {width:300});
  addField("Category","teamCategory", (f.teamCategory||""), {width:250});
  addField("90-day rule / notes","ninetyDayRule", (f.ninetyDayRule||""), {multiline:true, height:50});

  // SECTION 4
  heading("SECTION 4: FUNDING INFORMATION");
  addField("Amount requested ()","fundingAmount", (f.fundingAmount||""), {width:220});
  addField("Funding breakdown / justification","fundingDetails", (f.fundingDetails||""), {multiline:true, height:80});

  // SECTION 5
  heading("SECTION 5: IN YOUR OWN WORDS");
  addField("Tell us about yourself, your goals and plans for the season.","inYourOwnWords", (f.inYourOwnWords||f.personalStatement||""), {multiline:true, height:160});

  // Declaration
  heading("DECLARATION");
  y -= 14; page.drawText("I confirm that the information provided in this form is accurate to the best of my knowledge.", {x:M,y,size:11,font});
  ensure(48);
  const sigY = y - 10, sigW = 280;
  page.drawText("Applicant signature:", { x:M, y:sigY+24, size:11, font:bold });
  page.drawRectangle({ x:M, y:sigY, width:sigW, height:20, borderColor:rgb(.7,.7,.7), borderWidth:.8 });
  form.createTextField("signature").addToPage(page,{ x:M+2, y:sigY+2, width:sigW-4, height:16 });
  page.drawText("Date:", { x:M+sigW+20, y:sigY+24, size:11, font:bold });
  page.drawRectangle({ x:M+sigW+20, y:sigY, width:100, height:20, borderColor:rgb(.7,.7,.7), borderWidth:.8 });
  form.createTextField("signatureDate").addToPage(page,{ x:M+sigW+22, y:sigY+2, width:96, height:16 });

  return new Blob([await pdf.save()], { type: "application/pdf" });
}
</script>

<script>
window.handleDownloadPDF = async function () {
  try {
    window.formData = window.formData || { name: "Applicant" };
    const blob = await buildFillablePDF(window.formData);
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = `Rayner_Fillable_Application_${(window.formData.name||'Form').replace(/\s+/g,'_')}_2026.pdf`;
    document.body.appendChild(a); a.click(); a.remove();
    setTimeout(() => URL.revokeObjectURL(a.href), 1000);
  } catch (e) {
    console.error('Fillable PDF generation failed:', e);
    alert('Generating the fillable PDF failed. See console for details.');
  }
};
</script>
</body>
</html>
